<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Listen</title>
  <meta name="description" content="Minimal audio player by Amin" />
  <style>
    :root{
      /* Background image aspect ratio (height / width) */
      --bg-ratio: 1.66288; /* 3719 / 2296 */

      /* Card width shared between player and banner */
      --card-width: min(520px, 88vw);
      --banner-gap: 4em; /* ~ four Shift+Enter lines */
      --lift: -10vh;                     /* مقدار منفی یعنی بالاتر از وسط */
    }

    /* قبلی: .stack { display:flex; flex-direction:column; align-items:center; } */
    .stack{
      display:flex; flex-direction:column; align-items:center;
      transform: translateY(var(--lift));   /* ← اضافه */
    }

      /* Brand colors */
      --sky-light: #4FC3F7;
      --sky-dark:  #0D4B78;

      --glass: rgba(17,24,39,.45);
      --text: #e5e7eb;
    }

    html, body { height: 100; }
    body {
      margin: 0; color: var(--text);
      background-image:
        linear-gradient(rgba(0,0,0,.15), rgba(0,0,0,.25)),
        url('wallpaper.png'); /* set your path */
      background-repeat: no-repeat;
      background-position: center;
      background-size: cover;
      min-height: 100vh;
      height: max(100vh, calc(100vw * var(--bg-ratio)));
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }

    /* Center vertical stack: banner above, player below */
    .wrap { position: fixed; inset: 0; display: grid; place-items: center; pointer-events: none; }
    .stack { display: flex; flex-direction: column; align-items: center; }

    /* Top banner: transparent container; 1 inch narrower than player */
    .banner {
      width: calc(var(--card-width) - 96px); /* 1in = 96px */
      max-width: calc(92vw - 96px);
      margin-bottom: var(--banner-gap);
      text-align: center;
      pointer-events: none; /* don't block clicks to player */
    }

    /* Glassy TEXT (not background). Use Times New Roman here */
    .banner .text,
    .time,
    .vol label {
    color: rgba(255,255,255,.92);      /* سفید کم‌رنگ */
       text-shadow: 0 1px 2px rgba(0,0,0,.35);  /* کنتراست روی پس‌زمینه آبی */
      font-family: 'Times New Roman', Times, serif;
    }
    .banner .text{
      font-size: inherit;     /* same as Volume label size feel */
      line-height: 1.2;
      opacity: .85;
      white-space: nowrap;

      /* Glassy text effect */
      background: linear-gradient(135deg, rgba(255,255,255,0.6), rgba(255,255,255,0.1));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-fill-color: transparent;

      text-shadow:
        0 1px 1px rgba(255,255,255,0.4),
        0 2px 4px rgba(0,0,0,0.25);
    }

.bg-video {
  position: fixed;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;
  object-fit: cover;   /* تمام صفحه را پر می‌کند */
  z-index: -1;         /* زیر همه لایه‌ها */
  filter: brightness(.9) saturate(1.05); /* کمی هماهنگ با تم */
}

    .card {
  --glowA: 0;
  --glowSize: 20px;
      pointer-events: auto;
      width: var(--card-width);
      padding: 16px;
      border-radius: 16px;

      /* افکت شیشه‌ای با رنگ‌های برند آبی */
      background: linear-gradient(135deg,
              rgba(13, 75, 120, 0.25),   /* sky-dark نیمه‌شفاف */
              rgba(79, 195, 247, 0.12)   /* sky-light نیمه‌شفاف */
             );
      border: 1px solid rgba(255, 255, 255, 0.12);
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }

.card.glow {
  box-shadow:
    0 0 var(--glowSize) rgba(57,126,172,0.35),   /* #397EAC */
    0 0 calc(var(--glowSize) * 1.2) rgba(88,155,199,0.25), /* #589BC7 */
    0 4px 20px rgba(0,0,0,0.35);  /* سایه بیرونی برای عمق */
  background: linear-gradient(135deg,
              rgba(13, 75, 120, 0.5),
              rgba(79,195,247, 0.25));
  transition: box-shadow 0.1s ease, background 0.25s ease;
}

    /* Hide native controls; custom UI */
    audio { width: 100%; display: none; }

    .player {
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: 10px;
      align-items: center;
    }

    /* دکمه پایه */
.btn{
  appearance:none; border:0; cursor:pointer;
  display:grid; place-items:center;
  width:64px;           /* اگر کوچک/بزرگ بود این را تغییر بده */
  height:44px;
  border-radius:12px;
  background: linear-gradient(135deg, var(--sky-dark), var(--sky-light));
  color:#fff; font-weight:600;
  transition: box-shadow .25s ease;   /* ← قبلاً اشتباهی تودرتو بود */
}

/* Hover فقط هاله‌ی آبی؛ پس‌زمینه دست‌نخورده می‌مونه */
.btn:hover,
.btn:focus-visible{
  box-shadow:
    0 0 10px rgba(57,126,172,0.55),  /* #397EAC steel blue */
    0 0 16px rgba(88,155,199,0.45),  /* #589BC7 light steel blue */
    0 4px 12px rgba(0,0,0,0.35);
  outline:none;
}

/* آیکن Play/Pause با ماسک SVG و درخش ملایم */
.btn::before{
  content:"";
  display:block;
  width:28px;          /* سایز آیکون */
  height:28px;
  background: linear-gradient(135deg, #ffffff, #dbeafe);

  /* آیکن Play به‌صورت پیش‌فرض */
  -webkit-mask: url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'>\
  <polygon points='22,16 22,48 46,32'/>\
</svg>") center / contain no-repeat;
          mask: url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'>\
  <polygon points='22,16 22,48 46,32'/>\
</svg>") center / contain no-repeat;

  /* درخش ملایم */
  filter:
    drop-shadow(0 0 3px rgba(255,255,255,0.9))
    drop-shadow(0 0 6px rgba(56,160,237,0.8))
    drop-shadow(0 0 12px rgba(56,160,237,0.6));
  transition: filter .25s ease;
}

/* تقویت درخش هنگام Hover */
.btn:hover::before{
  filter:
    drop-shadow(0 0 4px rgba(255,255,255,1))
    drop-shadow(0 0 8px rgba(56,160,237,0.9))
    drop-shadow(0 0 16px rgba(56,160,237,0.7));
}

/* وقتی پخش شده (Pause state) → ماسک آیکن مکث */
.btn[data-state="pause"]::before{
  -webkit-mask: url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'>\
  <rect x='18' y='16' width='10' height='32' rx='2'/>\
  <rect x='36' y='16' width='10' height='32' rx='2'/>\
</svg>") center / contain no-repeat;
          mask: url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'>\
  <rect x='18' y='16' width='10' height='32' rx='2'/>\
  <rect x='36' y='16' width='10' height='32' rx='2'/>\
</svg>") center / contain no-repeat;
}

    /* Base range (WebKit/Chromium + generic) */
.range{
  -webkit-appearance: none; appearance: none;
  width: 100%; height: 10px; border-radius: 999px;

  --p: 0%; /* درصد پرشدگی، با JS آپدیت می‌شود */

  /* filled bar (no-repeat) + full track */
  background:
    linear-gradient(90deg, #0D4B78, #4079BF, #4FC3F7) no-repeat,
    rgba(255,255,255,.22);
  background-size: var(--p) 100%, 100% 100%;
  background-clip: border-box;
}

/* WebKit track: شفاف تا لایه‌ی بالا دیده شود */
.range::-webkit-slider-runnable-track{
  height: 10px; border-radius: 999px; background: transparent;
}

/* Firefox track + progress */
.range::-moz-range-track{
  height: 10px; border-radius: 999px; background: rgba(255,255,255,.22);
}
.range::-moz-range-progress{
  height: 10px; border-radius: 999px;
  background: linear-gradient(90deg, #0D4B78, #4079BF, #4FC3F7);
}

/* Thumb (همان قبلی) */
.range::-webkit-slider-thumb {
  -webkit-appearance: none; appearance: none;
  width: 18px; height: 18px; border-radius: 50%;
  
  /* شیشه‌ای + محو کننده رنگ پشت */
  background: radial-gradient(circle at 30% 30%, 
              rgba(255,255,255,0.9) 0%, 
              rgba(255,255,255,0.4) 60%, 
              rgba(255,255,255,0.2) 100%);
  border: 1px solid rgba(255,255,255,0.4);
  backdrop-filter: blur(2px);
  box-shadow:
    0 2px 4px rgba(0,0,0,0.25),
    inset 0 1px 2px rgba(255,255,255,0.6);

  margin-top: -4px;
  transition: all 0.25s ease;
}

.range::-moz-range-thumb {
  width: 18px; height: 18px; border-radius: 50%;

  background: linear-gradient(135deg,
              rgba(255,255,255,0.75),
              rgba(255,255,255,0.25));
  border: 1px solid rgba(255,255,255,0.4);
  box-shadow:
    0 2px 4px rgba(0,0,0,0.25),
    inset 0 1px 2px rgba(255,255,255,0.6);

  transition: all 0.25s ease;
}

/* ===== Hover حالت درخشش ===== */
.range:hover::-webkit-slider-thumb {
  background: linear-gradient(135deg,
              rgba(255,255,255,0.95),
              rgba(255,255,255,0.55));
  box-shadow:
    0 0 10px rgba(79,195,247,0.9),   /* Glow آبی بیرونی */
    0 2px 6px rgba(0,0,0,0.3),
    inset 0 1px 3px rgba(255,255,255,0.7);
}

.range:hover::-moz-range-thumb {
  background: linear-gradient(135deg,
              rgba(255,255,255,0.95),
              rgba(255,255,255,0.55));
  box-shadow:
    0 0 10px rgba(79,195,247,0.9),
    0 2px 6px rgba(0,0,0,0.3),
    inset 0 1px 3px rgba(255,255,255,0.7);
}

    .vol{ display:flex; align-items:center; gap:8px; margin-top:10px; }
    .time{ min-width:88px; text-align:center; opacity:.9; font-variant-numeric: tabular-nums; }
 
/* ===== Fix banner on phones: keep it centered and allow wrapping ===== */
@media (max-width: 480px){
  .banner{
    /* عرض کنترل‌شده و مرکز */
    width: calc(var(--card-width) - 64px);
    max-width: calc(92vw - 64px);
    margin-left: auto;
    margin-right: auto;
    text-align: center;
  }
  .banner .text{
    /* مشکل کشیده‌شدن به راست از nowrap بود */
    white-space: normal;     /* اجازه شکست سطر */
    display: inline-block;   /* برای مرکز‌ماندن مطمئن */
    font-size: 13.5px;       /* کمی ظریف‌تر روی موبایل (اختیاری) */
  }
}

@media (max-width: 480px){
  .lyrics-line{
    font-size: 0.95em;   /* فقط یک درجه کوچکتر */
  }
}

@supports (-webkit-touch-callout: none) {
  @media (max-width: 430px){
    .banner .text{
      font-size: calc(1em + 2px); /* یک درجه بزرگ‌تر فقط روی iPhone های رایج */
    }
  }
}

@supports (-webkit-touch-callout: none) {
  @media (max-width: 430px){
    .lyrics-line {
      font-size: calc(1em + 2px); /* یک درجه بزرگ‌تر فقط روی آیفون */
    }
  }
}


/* --- Lyrics container --- */
.lyrics{
  width: var(--card-width);
  margin: 1.2em auto 0;   /* قبلاً 2em بود؛ ~یک خط بالاتر رفت */
  position: relative;
  min-height: 2.2em;
  overflow: hidden;
  text-align: center;
  pointer-events: none;
}

.lyrics-line{
  position: absolute; inset: 0;
  display: flex; align-items: center; justify-content: center;
  opacity: 0;
  transform: none;  /* قبلاً translateY(8px) بود → حذف حرکت */
  transition: opacity 0.7s ease, filter 0.7s ease; /* transform را از ترنزیشن حذف کن */
  white-space: normal; line-height: 1.25;
  filter: drop-shadow(0 1px 2px rgba(0,0,0,.35));
  will-change: opacity;
}

/* ورود نرم */
.lyrics-line.active{
  opacity: 1;
  transform: none; /* یا می‌توانی کلاً این خط را حذف کنی */
}

/* استایل شیشه‌ای مطابق توضیح بالا */
.banner .text,
.lyrics-line{
  font-family: 'Times New Roman', Times, serif;
  background: linear-gradient(135deg, rgba(255,255,255,0.6), rgba(255,255,255,0.1));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-fill-color: transparent;
  text-shadow:
    0 1px 1px rgba(255,255,255,0.4),
    0 2px 4px rgba(0,0,0,0.25);
}

 </style>
</head>
<body>
  <!-- ویدئو بک‌گراند -->
  <video class="bg-video" autoplay muted loop playsinline>
    <source src="video.mp4" type="video/mp4">
  </video>

  <div class="wrap">
    <div class="stack" dir="ltr">
      <!-- بنر -->
      <div class="banner">
        <span class="text">Use your headphones for a better experience.</span>
      </div>

      <!-- کارت پلیر (همان فعلی) -->
      <div class="card">
        <audio id="audio" preload="metadata">
          <source src="its never gonna be okay.mp3" type="audio/mpeg" />
        </audio>

        <div class="player">
          <button class="btn" id="play" aria-label="Play" data-state="play"></button>
          <!-- simplified: only the range -->
          <input type="range" id="seek" class="range" value="0" min="0" max="100" step="0.1" aria-label="Seek">
          <div class="time"><span id="cur">0:00</span> / <span id="dur">0:00</span></div>
        </div>

        <div class="vol">
          <label for="vol">Volume</label>
          <input type="range" id="vol" class="range" min="0" max="1" step="0.01" value="1" aria-label="Volume">
        </div>
      </div>
    </div>
  </div>
 

  <script>
    const audio = document.getElementById('audio');
    const playBtn = document.getElementById('play');
    const seek = document.getElementById('seek');
    const cur = document.getElementById('cur');
    const dur = document.getElementById('dur');
    const vol = document.getElementById('vol');

    // Time formatter mm:ss
    const fmt = s => {
      if (!isFinite(s)) return '0:00';
      const m = Math.floor(s / 60);
      const ss = Math.floor(s % 60).toString().padStart(2, '0');
      return `${m}:${ss}`;
    };

    // Update duration when metadata is ready
    audio.addEventListener('loadedmetadata', () => {
      dur.textContent = fmt(audio.duration);
    });

    // Play/Pause
    playBtn.addEventListener('click', async () => {
  try {
    // تضمین ایجاد/Resume در جسچر کاربر
    if (!ac) initAnalyser();
    if (ac.state === 'suspended') await ac.resume();
  } catch {}

  if (audio.paused) {
    try { 
      await audio.play(); 
      playBtn.setAttribute('data-state','pause');
playBtn.setAttribute('aria-label','Pause');
      card.classList.add('glow');
      startGlowLoop();               // ← پالس را شروع کن
    } catch {}
  } else {
    audio.pause();
    playBtn.setAttribute('data-state','play');
playBtn.setAttribute('aria-label','Play');
    card.classList.remove('glow');
    stopGlowLoop();                  // ← پالس را متوقف کن
  }
});

// همگام‌سازی دفاعی (بماند)
audio.addEventListener('play',  () => { playBtn.setAttribute('data-state','pause');  playBtn.setAttribute('aria-label','Pause');  /*...*/ });
audio.addEventListener('pause', () => { playBtn.setAttribute('data-state','play');   playBtn.setAttribute('aria-label','Play');   /*...*/ });
audio.addEventListener('ended', () => { playBtn.setAttribute('data-state','play');   playBtn.setAttribute('aria-label','Play');   /*...*/ });

    // Progress update -> paint fill on the slider itself
    audio.addEventListener('timeupdate', () => {
      const p = (audio.currentTime / (audio.duration || 1)) * 100;
      seek.value = p;
      seek.style.setProperty('--p', `${p}%`);
      cur.textContent = fmt(audio.currentTime);

    });

    // User seeks
    seek.addEventListener('input', () => {
      const t = (seek.value / 100) * (audio.duration || 0);
      audio.currentTime = t;
      seek.style.setProperty('--p', `${seek.value}%`);
    });

    // Volume
    vol.addEventListener('input', () => {
  const v = +vol.value;
  if (gainNode) gainNode.gain.value = v;  // iOS/همه
  else audio.volume = v;                  // fallback دسکتاپ
});

// گرفتن کارت
const card = document.querySelector('.card');

// وقتی شروع به پخش شد → کارت بدرخشه
audio.addEventListener('play', () => {
  card.classList.add('glow');
});

// وقتی Pause یا تمام شد → Glow برداشته شود
audio.addEventListener('pause', () => {
  card.classList.remove('glow');
});
audio.addEventListener('ended', () => {
  card.classList.remove('glow');
});

// خاموش‌کردن پالس هنگام توقف/پایان
audio.addEventListener('pause', () => {
  const card = document.querySelector('.card');
  card?.style.setProperty('--glowA', '0');
  card?.style.setProperty('--glowSize', '20px');
});
audio.addEventListener('ended', () => {
  const card = document.querySelector('.card');
  card?.style.setProperty('--glowA', '0');
  card?.style.setProperty('--glowSize', '20px');
});

audio.addEventListener('error', () => {
  console.log('AUDIO ERROR', audio.error);
});


// ===== Beat-synced Glow via Web Audio Analyser =====
let ac, analyser, mediaSrc, fftBuf, rafId, glowOn = false, smooth = 0;

function initAnalyser(){
  if (ac) return;
  ac = new (window.AudioContext || window.webkitAudioContext)();
  mediaSrc = ac.createMediaElementSource(audio);

  gainNode = ac.createGain();
  gainNode.gain.value = +vol.value || 1;     // ← ولوم اولیه

  analyser = ac.createAnalyser();
  analyser.fftSize = 2048;
  analyser.smoothingTimeConstant = 0.85;

  // media → gain → analyser → speakers
  mediaSrc.connect(gainNode);
  gainNode.connect(analyser);
  analyser.connect(ac.destination);

  fftBuf = new Uint8Array(analyser.frequencyBinCount);
}

function startGlowLoop(){
  if (rafId) cancelAnimationFrame(rafId);
  glowOn = true;
  const loop = () => {
    if (!glowOn) return;
    analyser.getByteFrequencyData(fftBuf);

    const nyq = ac.sampleRate / 2;
    let sum = 0, n = 0;
    for (let i = 0; i < fftBuf.length; i++){
      const f = i * nyq / fftBuf.length;
      if (f >= 100 && f <= 2000){ sum += fftBuf[i]; n++; }
    }
    const level = n ? (sum / (n * 255)) : 0;  // 0..1
    smooth = smooth * 0.80 + level * 0.20;

    const volScale = 0.6 + 0.4 * (+vol.value || 0);
    const pulse = Math.min(1, smooth * 1.8) * volScale;

    const alpha = (0.25 + 0.55 * pulse) * 0.5;   // 0.25..0.80
    const size  = 12   + 16   * pulse;   // 12..28px
    card.style.setProperty('--glowA', alpha.toFixed(2));
    card.style.setProperty('--glowSize', `${Math.round(size)}px`);

    rafId = requestAnimationFrame(loop);
  };
  rafId = requestAnimationFrame(loop);
}

function stopGlowLoop(){
  glowOn = false;
  if (rafId) cancelAnimationFrame(rafId);
  card.style.setProperty('--glowA', '0');
  card.style.setProperty('--glowSize', '20px');
}

  </script>
</body>
</html>












